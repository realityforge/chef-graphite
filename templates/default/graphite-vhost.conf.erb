# Graphite Apache Virtual Host
#
# Generated by Chef

WSGIPythonOptimize 1
WSGIImportScript <%= node['graphite']['base_dir'] %>/conf/graphite.wsgi process-group=graphite application-group=%{GLOBAL}

<VirtualHost <%= node['graphite']['web']['interface'] %>:<%= node['graphite']['web']['port'] %>>
    ServerName <%= node['graphite']['web']['host'] %>
    DocumentRoot "<%= node['graphite']['base_dir'] %>/webapp"
    ErrorLog <%= node['graphite']['storage_dir'] %>/log/webapp/error.log
    CustomLog <%= node['graphite']['storage_dir'] %>/log/webapp/access.log common

    WSGIDaemonProcess graphite \
        user=<%= node['apache']['user'] %> processes=10 threads=5 maximum-requests=100000 inactivity-timeout=300 \
        python-path=<%= node['graphite']['base_dir'] %>/webapp

    WSGIProcessGroup graphite

    WSGIScriptAlias / <%= node['graphite']['base_dir'] %>/conf/graphite.wsgi

    SetEnv DJANGO_SETTINGS_MODULE graphite.settings
    SetEnv GRAPHITE_STORAGE_DIR <%= node['graphite']['storage_dir'] %>/

    <Location "/content/">
            SetHandler None
    </Location>

    <Location "/media/">
            SetHandler None
    </Location>
</VirtualHost>
